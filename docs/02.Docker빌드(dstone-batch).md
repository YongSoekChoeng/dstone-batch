[Dstone Document Index](../../docs/Index.md)

# ğŸ³ Dstone-Batch Docker ë¹Œë“œ ë° ì‹¤í–‰ ê°€ì´ë“œ

---

## 1. ì»¨í…Œì´ë„ˆ êµ¬ì„± ê°œìš”

ì´ ê°€ì´ë“œëŠ” Docker Composeë¥¼ ì‚¬ìš©í•˜ì—¬ `dstone-batch` ì• í”Œë¦¬ì¼€ì´ì…˜ ë° ê´€ë ¨ ì„œë¹„ìŠ¤ë¥¼ ì»¨í…Œì´ë„ˆë¡œ êµ¬ì„±í•˜ëŠ” ë°©ë²•ì„ ì„¤ëª…í•©ë‹ˆë‹¤.

**êµ¬ì„± ì»¨í…Œì´ë„ˆ:**

1.  **`dstone-mysql`**: ë°ì´í„°ë² ì´ìŠ¤ (MySQL)
2.  **`dstone-batch`**: ë°°ì¹˜ í”„ë ˆì„ì›Œí¬ ì• í”Œë¦¬ì¼€ì´ì…˜
3.  **`dstone-batch-server`**: ë°°ì¹˜ ê´€ë¦¬ ì„œë²„ (Spring Cloud Data Flow)

> ëª¨ë“  ì»¨í…Œì´ë„ˆëŠ” **í†µí•© ì‹¤í–‰** ë˜ëŠ” **ê°œë³„ ì‹¤í–‰**ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

---

## 2. í˜¸ìŠ¤íŠ¸ ë””ë ‰í† ë¦¬ êµ¬ì¡° ë° ì‚¬ì „ ì‘ì—…

1.  **ì‘ì—… ë””ë ‰í† ë¦¬ ìƒì„±**
    -   í˜¸ìŠ¤íŠ¸ ë¨¸ì‹ ì— `/workshop` ë””ë ‰í† ë¦¬ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

2.  **í…œí”Œë¦¿ íŒŒì¼ ë³µì‚¬**
    -   `dstone-batch` ê´€ë ¨ ì„¤ì • íŒŒì¼ê³¼ `docker-compose` íŒŒì¼ì„ ì•„ë˜ êµ¬ì¡°ì— ë§ê²Œ `/workshop` ë””ë ‰í† ë¦¬ë¡œ ë³µì‚¬í•©ë‹ˆë‹¤.

    ```text
    /workshop
      â”œâ”€ dstone-mysql/
      â”‚  â”œâ”€ init-db/
      â”‚  â”œâ”€ 01.dstone-mysql-docker.yml
      â”‚  â””â”€ 02.dstone-mysql-docker-reg.sh
      â”œâ”€ dstone-batch/
      â”‚  â”œâ”€ conf/
      â”‚  â”œâ”€ target/
      â”‚  â”œâ”€ 01.dstone-batch-docker.yml
      â”‚  â””â”€ 02.dstone-batch-docker-reg.sh
      â”œâ”€ dstone-batch-server/
      â”‚  â”œâ”€ conf/
      â”‚  â”œâ”€ target/
      â”‚  â”œâ”€ 01.dstone-batch-server-docker.yml
      â”‚  â””â”€ 02.dstone-batch-server-docker-reg.sh
      â””â”€ dstone-batch-docker-compose.yml  # í†µí•© ì‹¤í–‰ìš© ë©”ì¸ Compose íŒŒì¼
    ```

3.  **ì‹¤í–‰ íŒŒì¼ ì¤€ë¹„**
    > âš ï¸ **ì¤‘ìš”:** `target` ë””ë ‰í† ë¦¬ëŠ” `.gitignore`ì— ì˜í•´ ë²„ì „ ê´€ë¦¬ì—ì„œ ì œì™¸ë©ë‹ˆë‹¤. ë”°ë¼ì„œ Gitì—ì„œ ì†ŒìŠ¤ë¥¼ ë°›ì€ í›„, ê° í”„ë¡œì íŠ¸ë¥¼ ë¹Œë“œí•˜ì—¬ ìƒì„±ëœ `*.jar` íŒŒì¼ì„ í•´ë‹¹ `target` ë””ë ‰í† ë¦¬ì— ìˆ˜ë™ìœ¼ë¡œ ë³µì‚¬í•´ì•¼ í•©ë‹ˆë‹¤.

4.  **íŒŒì¼ ê¶Œí•œ ì„¤ì • ë° í˜•ì‹ ë³€í™˜ (Linux/WSL)**
    -   ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ë° íŒŒì¼ ì ‘ê·¼ ê¶Œí•œì„ ì„¤ì •í•©ë‹ˆë‹¤.
    ```bash
    cd /workshop
    sudo chown -R root:root *
    sudo chmod -R 777 *
    # Windowsì—ì„œ ì‘ì„±ëœ íŒŒì¼ì˜ ê²½ìš°, ê°œí–‰ ë¬¸ìë¥¼ ë³€í™˜í•©ë‹ˆë‹¤.
    find . -name "*.sh" -exec dos2unix {} \;
    ```

---

## 3. í†µí•© ì‹¤í–‰ (ì „ì²´ ì„œë¹„ìŠ¤)

`dstone-batch-docker-compose.yml` íŒŒì¼ì„ ì‚¬ìš©í•˜ì—¬ ëª¨ë“  ì„œë¹„ìŠ¤ë¥¼ í•œ ë²ˆì— ì‹¤í–‰í•©ë‹ˆë‹¤.

### 3.1. ì‹¤í–‰ ë° ë¡œê·¸ í™•ì¸

-   **ëª¨ë“  ì„œë¹„ìŠ¤ ì‹¤í–‰**
    ```bash
    # -p dstone: 'dstone'ì„ í”„ë¡œì íŠ¸ ì´ë¦„ìœ¼ë¡œ ì§€ì •í•˜ì—¬ ê´€ë ¨ ë¦¬ì†ŒìŠ¤(ë„¤íŠ¸ì›Œí¬ ë“±)ë¥¼ ê·¸ë£¹í™”í•©ë‹ˆë‹¤.
    docker compose -p dstone -f /workshop/dstone-batch-docker-compose.yml up -d
    ```

-   **ì‹¤ì‹œê°„ ë¡œê·¸ í™•ì¸**
    ```bash
    docker compose -p dstone -f /workshop/dstone-batch-docker-compose.yml logs -f
    ```

### 3.2. ì¤‘ì§€ ë° ì‚­ì œ

-   **ì„œë¹„ìŠ¤ ì¤‘ì§€ ë° ì»¨í…Œì´ë„ˆ ì‚­ì œ**
    ```bash
    docker compose -p dstone -f /workshop/dstone-batch-docker-compose.yml down
    ```

-   **ì„œë¹„ìŠ¤ ì¤‘ì§€ ë° ì»¨í…Œì´ë„ˆ/ë³¼ë¥¨ ëª¨ë‘ ì‚­ì œ**
    > âš ï¸ **ì£¼ì˜:** `-v` ì˜µì…˜ì€ `dstone-mysql`ì˜ ë°ì´í„° ë³¼ë¥¨ì„ í¬í•¨í•œ ëª¨ë“  Docker ë³¼ë¥¨ì„ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œí•©ë‹ˆë‹¤. ë°ì´í„°ë² ì´ìŠ¤ ì •ë³´ë¥¼ ìœ ì§€í•˜ë ¤ë©´ ì´ ì˜µì…˜ì„ ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”.
    ```bash
    docker compose -p dstone -f /workshop/dstone-batch-docker-compose.yml down -v
    ```

---

## 4. ê°œë³„ ì‹¤í–‰ (ì„œë¹„ìŠ¤ ë‹¨ìœ„)

ê° ì„œë¹„ìŠ¤ì˜ `01.*-docker.yml` íŒŒì¼ì„ ì‚¬ìš©í•˜ì—¬ ê°œë³„ì ìœ¼ë¡œ ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤. ì„œë¹„ìŠ¤ ë‹¨ìœ„ì˜ í…ŒìŠ¤íŠ¸ ë° ê°œë°œì— ìœ ìš©í•©ë‹ˆë‹¤.

### 4.1. ì‹¤í–‰ ìˆœì„œ ë° ì£¼ì˜ì‚¬í•­

> âš ï¸ **ì‹¤í–‰ ìˆœì„œ:** `dstone-batch`ì™€ `dstone-batch-server`ëŠ” `dstone-mysql`ì— ì˜ì¡´í•˜ë¯€ë¡œ, **ë°˜ë“œì‹œ `dstone-mysql` ì»¨í…Œì´ë„ˆë¥¼ ê°€ì¥ ë¨¼ì € ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤.**

> âš ï¸ **DB ì´ˆê¸°í™”:** ë§Œì•½ `dstone-boot` í”„ë ˆì„ì›Œí¬ë¥¼ ì´ë¯¸ ì‚¬ìš©í•˜ì—¬ `dstone-mysql` ë°ì´í„°ë² ì´ìŠ¤ê°€ ì´ˆê¸°í™”ëœ ìƒíƒœë¼ë©´, `/workshop/dstone-mysql/init-db/` ë””ë ‰í† ë¦¬ì—ì„œ `dstone-boot` ê´€ë ¨ `*.sql` íŒŒì¼ë“¤ì„ ì œê±°í•˜ì—¬ ì¤‘ë³µ ì‹¤í–‰ì„ ë°©ì§€í•˜ì„¸ìš”.

### 4.2. ì„œë¹„ìŠ¤ë³„ ì‹¤í–‰ ëª…ë ¹ì–´

-   **1. MySQL ì‹¤í–‰**
    ```bash
    docker compose -p dstone -f /workshop/dstone-mysql/01.dstone-mysql-docker.yml up -d
    ```
-   **2. Batch Application ì‹¤í–‰**
    ```bash
    docker compose -p dstone -f /workshop/dstone-batch/01.dstone-batch-docker.yml up -d
    ```
-   **3. Batch Admin Server ì‹¤í–‰**
    ```bash
    docker compose -p dstone -f /workshop/dstone-batch-server/01.dstone-batch-server-docker.yml up -d
    ```

### 4.3. ì„œë¹„ìŠ¤ë³„ ë¡œê·¸ ë° ì¤‘ì§€ ëª…ë ¹ì–´

-   **ë¡œê·¸ í™•ì¸** (ì˜ˆ: `dstone-batch`)
    ```bash
    docker compose -p dstone -f /workshop/dstone-batch/01.dstone-batch-docker.yml logs -f
    ```
-   **ì¤‘ì§€ ë° ì‚­ì œ** (ì˜ˆ: `dstone-batch`)
    ```bash
    docker compose -p dstone -f /workshop/dstone-batch/01.dstone-batch-docker.yml down -v
    ```

### 4.4. ê°œë³„ ì»¨í…Œì´ë„ˆ ì œì–´

```bash
docker stop dstone-batch
docker start dstone-batch
```
---

## 5. Docker Hub ì´ë¯¸ì§€ ë“±ë¡

í•„ìš”ì— ë”°ë¼ ê° ì„œë¹„ìŠ¤ì˜ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•˜ì—¬ Docker Hubì— í‘¸ì‹œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê° ì„œë¹„ìŠ¤ ë””ë ‰í† ë¦¬ì˜ `02.*-docker-reg.sh` ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.

-   `/workshop/dstone-mysql/02.dstone-mysql-docker-reg.sh`
-   `/workshop/dstone-batch/02.dstone-batch-docker-reg.sh`
-   `/workshop/dstone-batch-server/02.dstone-batch-server-docker-reg.sh`
