# ğŸ³ Dstone Batch (ë°°ì¹˜í”„ë ˆì„ì›) Docker ë¹Œë“œ ë° ì‹¤í–‰ ê°€ì´ë“œ

---

## 1. ì»¨í…Œì´ë„ˆ êµ¬ì„± ê°œìš”

ë³¸ í”„ë¡œì íŠ¸ëŠ” Docker Composeë¥¼ ì‚¬ìš©í•˜ì—¬ ì•„ë˜ **3ê°œì˜ ì»¨í…Œì´ë„ˆ**ë¥¼ êµ¬ì„±í•©ë‹ˆë‹¤.

1. **dstone-mysql** : ë°ì´í„°ë² ì´ìŠ¤ (MySQL)
2. **dstone-batch** : ë°°ì¹˜í”„ë ˆì„ì› Application
3. **dstone-batch-admin** : ë°°ì¹˜í”„ë ˆì„ì› Application ê´€ë¦¬ì„œë²„

- ëª¨ë“  ì»¨í…Œì´ë„ˆëŠ” **ì¼ê´„ ì‹¤í–‰** ë˜ëŠ” **ê°œë³„ ì‹¤í–‰**ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

---

## 2. ì‚¬ì „ ì‘ì—…

1. ì‘ì—… ë””ë ‰í† ë¦¬ ê²°ì •
2. í…œí”Œë¦¿ ë³µì‚¬

```text
/workshop
```

---

## 3. WSL í˜¸ìŠ¤íŠ¸ ë””ë ‰í† ë¦¬ êµ¬ì¡°

```text
/workshop
  â””â”€ /dstone-mysql                             # <Database (MySQL)>
     â”œâ”€ init-db/                               #   DB ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸
     â”œâ”€ 01.dstone-mysql-docker.yml             #   ê°œë³„ Docker Compose ë¹Œë“œíŒŒì¼
     â””â”€ 02.dstone-mysql-docker-reg.sh          #   Docker Hub ë“±ë¡ Shell
  â””â”€ /dstone-batch                             # <Batch Application>
     â”œâ”€ conf/                                  #   ì„¤ì • íŒŒì¼
     â”œâ”€ target/                                #   ì‹¤í–‰ íŒŒì¼
     â”œâ”€ 01.dstone-batch-docker.yml             #   ê°œë³„ Docker Compose ë¹Œë“œíŒŒì¼
     â””â”€ 02.dstone-batch-docker-reg.sh          #   Docker Hub ë“±ë¡ Shell
  â””â”€ /dstone-batch-server                      # <Batch Admin Application>
     â”œâ”€ conf/                                  #   ì„¤ì • íŒŒì¼
     â”œâ”€ target/                                #   ì‹¤í–‰ íŒŒì¼
     â”œâ”€ 01.dstone-batch-server-docker.yml      #   ê°œë³„ Docker Compose ë¹Œë“œíŒŒì¼
     â””â”€ 02.dstone-batch-server-docker-reg.sh   #   Docker Hub ë“±ë¡ Shell
  â””â”€ /workshop/dstone-batch-docker-compose.yml # ë©”ì¸ Docker Compose ë¹Œë“œíŒŒì¼
```

- **/target ë””ë ‰í† ë¦¬ëŠ” git ignore ë˜ì–´ ìˆìœ¼ë¯€ë¡œ ìµœì´ˆ Pullì„ í–ˆì„ ë•Œ ì¡´ì¬í•˜ì§€ ì•ŠìŒ. ë”°ë¼ì„œ ìˆ˜ë™ìœ¼ë¡œ ë§Œë“¤ì–´ ì£¼ê³  ì‹¤í–‰ íŒŒì¼(*.jar/war)ì„ ë³µì‚¬ í•´ì£¼ì–´ì•¼ í•¨.

---

## 4. ì‚¬ì „ì‘ì—…

### 4.1 ì‘ì—…ë””ë ‰í† ë¦¬ë¡œ ì´ë™
```bash
cd /workshop
```

### 4.2 ì‚¬ìš©ì ë³€ê²½, íŒŒì¼ê¶Œí•œ ë³€ê²½
```bash
chown -R root:root *
chmod -R 777 *
cdos 
```
- í•˜ìœ„ë””ë ‰í† ë¦¬ê¹Œì§€ dos2unix ì ìš© ëª…ë ¹ ì•Œë¦¬ì•„ìŠ¤
- alias cdos='find . -type f \( -name "*.sh" -o -name "*.sql" -o -name "*.yml" \) -exec dos2unix {} \;')

---

## 5. ì‘ì—… ëª…ë ¹ â€“ ì¼ê´„ ì‹¤í–‰ (docker-compose.yml)

### 5.1 Docker Compose ì‹¤í–‰

```bash
docker-compose -p dstone -f /workshop/dstone-batch-docker-compose.yml up -d
```

### 5.2 ë¡œê·¸ í™•ì¸

```bash
docker-compose -p dstone -f /workshop/dstone-batch-docker-compose.yml logs -f
```

### 5.3 ì¤‘ì§€ ë° ì‚­ì œ(ë³¼ë¥¨ì„ ê·¸ëŒ€ë¡œ ë‘ë ¤ë©´ -v ì˜µì…˜ì„ ì œê±°)

```bash
docker-compose -p dstone -f /workshop/dstone-batch-docker-compose.yml down -v
```

---

## 6. ì‘ì—… ëª…ë ¹ â€“ ê°œë³„ ì‹¤í–‰ (ì„œë¹„ìŠ¤ë³„ docker yml)

### 6.1 Docker Compose ì‹¤í–‰

```bash
# MySQL
docker-compose -p dstone -f /workshop/dstone-mysql/01.dstone-mysql-docker.yml up -d

# Application
docker-compose -p dstone -f /workshop/dstone-batch/01.dstone-batch-docker.yml up -d

# Admin Application
docker-compose -p dstone -f /workshop/dstone-batch-server/01.dstone-batch-server-docker.yml up -d
```

> âš ï¸ **ì£¼ì˜ì‚¬í•­**  
> ê°œë³„ ì‹¤í–‰ ì‹œ ë°˜ë“œì‹œ **dstone-mysqlì„ ë¨¼ì € ì‹¤í–‰**í•´ì•¼ í•©ë‹ˆë‹¤.  
> ë‚˜ë¨¸ì§€ ì»¨í…Œì´ë„ˆëŠ” ìˆœì„œì— ê´€ê³„ì—†ì´ ì‹¤í–‰ ê°€ëŠ¥í•©ë‹ˆë‹¤.
> ë§Œì¼ Dstone Boot Application(í”„ë ˆì„ì›)ì„ ì´ë¯¸ ì‚¬ìš©í•˜ê³  ìˆì„ ê²½ìš° ë°ì´í„°ë² ì´ìŠ¤(MySQL)ì˜ ì´ˆê¸°ë°ì´í„°ì¤‘ init-db/*dstone-boot.sql ë“¤ì€ ì œê±°í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.(ì´ë¯¸ ìƒì„±ë˜ì–´ìˆìŒ)

---

### 6.2 ë¡œê·¸ í™•ì¸

```bash
# MySQL
docker-compose -p dstone -f /workshop/dstone-mysql/01.dstone-mysql-docker.yml logs -f dstone-mysql

# Application
docker-compose -p dstone -f /workshop/dstone-batch/01.dstone-batch-docker.yml logs -f dstone-batch

# Admin Application
docker-compose -p dstone -f /workshop/dstone-batch-server/01.dstone-batch-server-docker.yml logs -f dstone-batch-server
```

---

### 6.3 ì¤‘ì§€ ë° ì‚­ì œ(ë³¼ë¥¨ì„ ê·¸ëŒ€ë¡œ ë‘ë ¤ë©´ -v ì˜µì…˜ì„ ì œê±°)

```bash
# MySQL
docker-compose -p dstone -f /workshop/dstone-mysql/01.dstone-mysql-docker.yml down -v

# Application
docker-compose -p dstone -f /workshop/dstone-batch/01.dstone-batch-docker.yml down -v

# Admin Application
docker-compose -p dstone -f /workshop/dstone-batch-server/01.dstone-batch-server-docker.yml down -v
```

---

### 6.4 ì»¨í…Œì´ë„ˆ ì¤‘ì§€

```bash
# Application
docker stop dstone-batch
# Admin Application
docker stop dstone-batch-server
# MySQL
docker stop dstone-mysql
```

---

### 6.5 ì»¨í…Œì´ë„ˆ ì‹œì‘

```bash
# MySQL
docker start dstone-mysql
# Application
docker start dstone-boot
# Admin Application
docker start dstone-batch-server
```
---

## 7. Docker Hub ì´ë¯¸ì§€ ë“±ë¡

ê° ì„œë¹„ìŠ¤ë³„ Docker ì´ë¯¸ì§€ë¥¼ Docker Hubì— ë“±ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```text
/workshop/dstone-mysql/02.dstone-mysql-docker-reg.sh
/workshop/dstone-batch/02.dstone-batch-docker-reg.sh
/workshop/dstone-batch-server/02.dstone-batch-server-docker-reg.sh
```

---

## 8. ì •ë¦¬

- **ì¼ê´„ ì‹¤í–‰**: ì „ì²´ ì„œë¹„ìŠ¤ í•œ ë²ˆì— ê¸°ë™
- **ê°œë³„ ì‹¤í–‰**: ì„œë¹„ìŠ¤ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ë° ê°œë°œ
- **MySQL ìš°ì„  ê¸°ë™ í•„ìˆ˜**
- `down -v` ì˜µì…˜ ì‚¬ìš© ì‹œ **ë°ì´í„° ë³¼ë¥¨ ì‚­ì œ ì£¼ì˜**

---

